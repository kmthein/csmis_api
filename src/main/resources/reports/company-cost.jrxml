<?xml version="1.0" encoding="UTF-8"?>
<!-- Created with Jaspersoft Studio version 6.20.5.final using JasperReports Library version 6.20.5-3efcf2e67f959db3888d79f73dde2dbd7acb4f8e  -->
<jasperReport xmlns="http://jasperreports.sourceforge.net/jasperreports" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://jasperreports.sourceforge.net/jasperreports http://jasperreports.sourceforge.net/xsd/jasperreport.xsd" name="company-cost" pageWidth="595" pageHeight="842" columnWidth="555" leftMargin="20" rightMargin="20" topMargin="20" bottomMargin="20" uuid="b220e1dd-654f-4e4f-beef-4f16108fcb69">
	<property name="com.jaspersoft.studio.data.sql.tables" value=""/>
	<property name="com.jaspersoft.studio.data.defaultdataadapter" value="csmis dataadapter-Database JDBC Connection"/>
	<parameter name="report_type" class="java.lang.String"/>
	<parameter name="date" class="java.util.Date"/>
	<parameter name="start_date" class="java.util.Date"/>
	<parameter name="end_date" class="java.util.Date"/>
	<parameter name="month" class="java.lang.Integer"/>
	<parameter name="year" class="java.lang.Integer"/>
	<queryString language="SQL">
		<![CDATA[SELECT 
    l.date AS date,
    l.company_rate AS company_rate,
    l.price AS price,
    o.quantity AS quantity,
    (COUNT(DISTINCT uhl.user_id) + 
    COUNT(DISTINCT d.user_id)) AS user_id,
    ((o.quantity * l.price) - ((COUNT(DISTINCT uhl.user_id) + 
    COUNT(DISTINCT d.user_id)) * (price - ((company_rate / 100 ) * l.price)))) AS amount,
    SUM(
      ((o.quantity * l.price) - ((COUNT(DISTINCT uhl.user_id) + 
    COUNT(DISTINCT d.user_id)) * (price - ((company_rate / 100 ) * l.price))))
    ) OVER () AS total_amount
FROM 
    lunch l
LEFT JOIN 
    order_row o ON l.date = o.lunch_date
LEFT JOIN 
	user_has_lunch uhl ON l.date= uhl.dt
LEFT JOIN 
    door_access_record d 
    ON l.date = d.date AND d.user_id NOT IN (
        SELECT user_id FROM user_has_lunch WHERE dt = l.date
    )
WHERE 
    (
    ($P{report_type} = 'daily' AND l.date = $P{date}) OR
    ($P{report_type} = 'weekly' AND l.date BETWEEN $P{start_date} AND $P{end_date}) OR
    ($P{report_type} = 'monthly' AND EXTRACT(MONTH FROM l.date) = $P{month} AND EXTRACT(YEAR FROM l.date) = $P{year})
)
GROUP BY 
    l.date, o.quantity, l.company_rate, l.price
ORDER BY 
    l.date;]]>
	</queryString>
	<field name="date" class="java.sql.Date">
		<property name="com.jaspersoft.studio.field.name" value="date"/>
		<property name="com.jaspersoft.studio.field.label" value="date"/>
		<property name="com.jaspersoft.studio.field.tree.path" value="lunch"/>
	</field>
	<field name="company_rate" class="java.lang.Double">
		<property name="com.jaspersoft.studio.field.name" value="company_rate"/>
		<property name="com.jaspersoft.studio.field.label" value="company_rate"/>
		<property name="com.jaspersoft.studio.field.tree.path" value="lunch"/>
	</field>
	<field name="price" class="java.lang.Double">
		<property name="com.jaspersoft.studio.field.name" value="price"/>
		<property name="com.jaspersoft.studio.field.label" value="price"/>
		<property name="com.jaspersoft.studio.field.tree.path" value="lunch"/>
	</field>
	<field name="quantity" class="java.lang.Integer">
		<property name="com.jaspersoft.studio.field.name" value="quantity"/>
		<property name="com.jaspersoft.studio.field.label" value="quantity"/>
		<property name="com.jaspersoft.studio.field.tree.path" value="order_row"/>
	</field>
	<field name="user_id" class="java.lang.Long">
		<property name="com.jaspersoft.studio.field.name" value="user_id"/>
		<property name="com.jaspersoft.studio.field.label" value="user_id"/>
	</field>
	<field name="amount" class="java.lang.Double">
		<property name="com.jaspersoft.studio.field.name" value="amount"/>
		<property name="com.jaspersoft.studio.field.label" value="amount"/>
	</field>
	<field name="total_amount" class="java.lang.Double">
		<property name="com.jaspersoft.studio.field.name" value="total_amount"/>
		<property name="com.jaspersoft.studio.field.label" value="total_amount"/>
	</field>
	<background>
		<band splitType="Stretch"/>
	</background>
	<title>
		<band height="80" splitType="Stretch">
			<image>
				<reportElement x="0" y="30" width="69" height="49" uuid="550e5fad-929a-477a-a471-9a359438962b"/>
				<imageExpression><![CDATA[net.sf.jasperreports.engine.util.JRLoader.loadBytes(getClass().getResource("/images/DAT Logo.png"))]]></imageExpression>
			</image>
			<staticText>
				<reportElement x="355" y="30" width="84" height="29" uuid="57ec15ca-de82-425d-b946-b05e6302be3c"/>
				<textElement textAlignment="Left" verticalAlignment="Top">
					<font size="10" isBold="false"/>
				</textElement>
				<text><![CDATA[Report Name :]]></text>
			</staticText>
			<textField>
				<reportElement x="440" y="30" width="121" height="27" uuid="9a910be9-6f6e-4c86-97c2-ad34f75c5c8b"/>
				<textFieldExpression><![CDATA["Company_Costing          (For "+ 
          ($P{report_type}.equals("daily") ? "Daily" : 
          ($P{report_type}.equals("weekly") ? "Weekly" : 
          ($P{report_type}.equals("monthly") ? "Monthly" : 
          ($P{report_type}.equals("yearly") ? "Yearly" : "Unknown"))))+")"]]></textFieldExpression>
			</textField>
			<staticText>
				<reportElement x="355" y="60" width="84" height="20" uuid="4d32257f-380a-4736-bdc4-dd2b7efc601a"/>
				<textElement textAlignment="Left">
					<font size="10" isBold="false"/>
				</textElement>
				<text><![CDATA[Report Date   :]]></text>
			</staticText>
			<textField pattern="MMMMM dd, yyyy">
				<reportElement x="440" y="60" width="100" height="20" uuid="e8857c64-0242-4d5e-b393-6c92132c472f"/>
				<textElement textAlignment="Left"/>
				<textFieldExpression><![CDATA[new java.util.Date()]]></textFieldExpression>
			</textField>
		</band>
	</title>
	<columnHeader>
		<band height="40" splitType="Stretch">
			<staticText>
				<reportElement mode="Opaque" x="0" y="10" width="100" height="30" forecolor="#FFFFFF" backcolor="#336699" uuid="9e7ec909-5dee-49c7-a84b-9247aac5ab74">
					<property name="com.jaspersoft.studio.spreadsheet.connectionID" value="64a70699-8d1d-43b9-a531-b2557e16dcf9"/>
				</reportElement>
				<box leftPadding="1" rightPadding="1">
					<pen lineWidth="0.5"/>
					<topPen lineWidth="1.0" lineStyle="Solid" lineColor="#000000"/>
					<leftPen lineWidth="1.0" lineStyle="Solid" lineColor="#000000"/>
					<bottomPen lineWidth="1.0" lineStyle="Solid" lineColor="#000000"/>
					<rightPen lineWidth="1.0" lineStyle="Solid" lineColor="#000000"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font isBold="true"/>
				</textElement>
				<text><![CDATA[Date]]></text>
			</staticText>
			<staticText>
				<reportElement mode="Opaque" x="100" y="10" width="100" height="30" forecolor="#FFFFFF" backcolor="#336699" uuid="0f2e2fa6-0fe3-4d78-8f1d-ecfd13d7d4b9">
					<property name="com.jaspersoft.studio.spreadsheet.connectionID" value="64a70699-8d1d-43b9-a531-b2557e16dcf9"/>
				</reportElement>
				<box leftPadding="1" rightPadding="1">
					<pen lineWidth="0.5"/>
					<topPen lineWidth="1.0" lineStyle="Solid" lineColor="#000000"/>
					<leftPen lineWidth="1.0" lineStyle="Solid" lineColor="#000000"/>
					<bottomPen lineWidth="1.0" lineStyle="Solid" lineColor="#000000"/>
					<rightPen lineWidth="1.0" lineStyle="Solid" lineColor="#000000"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font isBold="true"/>
				</textElement>
				<text><![CDATA[No. of Pax]]></text>
			</staticText>
			<staticText>
				<reportElement mode="Opaque" x="200" y="10" width="80" height="30" forecolor="#FFFFFF" backcolor="#336699" uuid="6bf7ace6-c9e5-461f-ba3c-a1d729a993aa">
					<property name="com.jaspersoft.studio.spreadsheet.connectionID" value="64a70699-8d1d-43b9-a531-b2557e16dcf9"/>
				</reportElement>
				<box leftPadding="1" rightPadding="1">
					<pen lineWidth="0.5"/>
					<topPen lineWidth="1.0" lineStyle="Solid" lineColor="#000000"/>
					<leftPen lineWidth="1.0" lineStyle="Solid" lineColor="#000000"/>
					<bottomPen lineWidth="1.0" lineStyle="Solid" lineColor="#000000"/>
					<rightPen lineWidth="1.0" lineStyle="Solid" lineColor="#000000"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font isBold="true"/>
				</textElement>
				<text><![CDATA[Total_DoorLog]]></text>
			</staticText>
			<staticText>
				<reportElement mode="Opaque" x="439" y="10" width="122" height="30" forecolor="#FFFFFF" backcolor="#336699" uuid="16035965-2c15-433e-8e14-8cc9db71466c">
					<property name="com.jaspersoft.studio.spreadsheet.connectionID" value="64a70699-8d1d-43b9-a531-b2557e16dcf9"/>
				</reportElement>
				<box leftPadding="1" rightPadding="1">
					<pen lineWidth="0.5"/>
					<topPen lineWidth="1.0" lineStyle="Solid" lineColor="#000000"/>
					<leftPen lineWidth="1.0" lineStyle="Solid" lineColor="#000000"/>
					<bottomPen lineWidth="1.0" lineStyle="Solid" lineColor="#000000"/>
					<rightPen lineWidth="1.0" lineStyle="Solid" lineColor="#000000"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font isBold="true"/>
				</textElement>
				<text><![CDATA[Company_Cost]]></text>
			</staticText>
			<staticText>
				<reportElement mode="Opaque" x="280" y="10" width="80" height="30" forecolor="#FFFFFF" backcolor="#336699" uuid="3deba8cd-b91c-40f1-b1e3-d14a57f12615">
					<property name="com.jaspersoft.studio.spreadsheet.connectionID" value="64a70699-8d1d-43b9-a531-b2557e16dcf9"/>
				</reportElement>
				<box leftPadding="1" rightPadding="1">
					<pen lineWidth="0.5"/>
					<topPen lineWidth="1.0" lineStyle="Solid" lineColor="#000000"/>
					<leftPen lineWidth="1.0" lineStyle="Solid" lineColor="#000000"/>
					<bottomPen lineWidth="1.0" lineStyle="Solid" lineColor="#000000"/>
					<rightPen lineWidth="1.0" lineStyle="Solid" lineColor="#000000"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font isBold="true"/>
				</textElement>
				<text><![CDATA[Price]]></text>
			</staticText>
			<staticText>
				<reportElement mode="Opaque" x="360" y="10" width="79" height="30" forecolor="#FFFFFF" backcolor="#336699" uuid="deda36b1-68f5-4ab0-874a-e5538f2ccdf4">
					<property name="com.jaspersoft.studio.spreadsheet.connectionID" value="64a70699-8d1d-43b9-a531-b2557e16dcf9"/>
				</reportElement>
				<box leftPadding="1" rightPadding="1">
					<pen lineWidth="0.5"/>
					<topPen lineWidth="1.0" lineStyle="Solid" lineColor="#000000"/>
					<leftPen lineWidth="1.0" lineStyle="Solid" lineColor="#000000"/>
					<bottomPen lineWidth="1.0" lineStyle="Solid" lineColor="#000000"/>
					<rightPen lineWidth="1.0" lineStyle="Solid" lineColor="#000000"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font isBold="true"/>
				</textElement>
				<text><![CDATA[Company_Rate]]></text>
			</staticText>
		</band>
	</columnHeader>
	<detail>
		<band height="26" splitType="Stretch">
			<textField>
				<reportElement x="100" y="0" width="100" height="26" uuid="440bbb51-a8e6-49eb-ab47-67b0dbc8fbaa">
					<property name="com.jaspersoft.studio.spreadsheet.connectionID" value="b8793c8f-1f79-4362-9067-f863fa206891"/>
				</reportElement>
				<box leftPadding="1" rightPadding="1">
					<pen lineWidth="0.5"/>
					<topPen lineWidth="1.0" lineStyle="Solid" lineColor="#000000"/>
					<leftPen lineWidth="1.0" lineStyle="Solid" lineColor="#000000"/>
					<bottomPen lineWidth="1.0" lineStyle="Solid" lineColor="#000000"/>
					<rightPen lineWidth="1.0" lineStyle="Solid" lineColor="#000000"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle"/>
				<textFieldExpression><![CDATA[$F{quantity}]]></textFieldExpression>
			</textField>
			<textField>
				<reportElement x="440" y="0" width="121" height="26" uuid="7c927da9-be0f-4b84-baf0-08e62b579617">
					<property name="com.jaspersoft.studio.spreadsheet.connectionID" value="b8793c8f-1f79-4362-9067-f863fa206891"/>
				</reportElement>
				<box leftPadding="1" rightPadding="1">
					<pen lineWidth="0.5"/>
					<topPen lineWidth="1.0" lineStyle="Solid" lineColor="#000000"/>
					<leftPen lineWidth="1.0" lineStyle="Solid" lineColor="#000000"/>
					<bottomPen lineWidth="1.0" lineStyle="Solid" lineColor="#000000"/>
					<rightPen lineWidth="1.0" lineStyle="Solid" lineColor="#000000"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle"/>
				<textFieldExpression><![CDATA[$F{amount}]]></textFieldExpression>
			</textField>
			<textField>
				<reportElement x="0" y="0" width="100" height="26" uuid="02dfce32-3947-4495-8e74-5a07e8a39c8b">
					<property name="com.jaspersoft.studio.spreadsheet.connectionID" value="b8793c8f-1f79-4362-9067-f863fa206891"/>
				</reportElement>
				<box leftPadding="1" rightPadding="1">
					<pen lineWidth="0.5"/>
					<topPen lineWidth="1.0" lineStyle="Solid" lineColor="#000000"/>
					<leftPen lineWidth="1.0" lineStyle="Solid" lineColor="#000000"/>
					<bottomPen lineWidth="1.0" lineStyle="Solid" lineColor="#000000"/>
					<rightPen lineWidth="1.0" lineStyle="Solid" lineColor="#000000"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle"/>
				<textFieldExpression><![CDATA[$F{date}]]></textFieldExpression>
			</textField>
			<textField>
				<reportElement x="200" y="0" width="80" height="26" uuid="71af9059-1d5f-490a-a105-6836e5953e2f">
					<property name="com.jaspersoft.studio.spreadsheet.connectionID" value="b8793c8f-1f79-4362-9067-f863fa206891"/>
				</reportElement>
				<box leftPadding="1" rightPadding="1">
					<pen lineWidth="0.5"/>
					<topPen lineWidth="1.0" lineStyle="Solid" lineColor="#000000"/>
					<leftPen lineWidth="1.0" lineStyle="Solid" lineColor="#000000"/>
					<bottomPen lineWidth="1.0" lineStyle="Solid" lineColor="#000000"/>
					<rightPen lineWidth="1.0" lineStyle="Solid" lineColor="#000000"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle"/>
				<textFieldExpression><![CDATA[$F{user_id}]]></textFieldExpression>
			</textField>
			<textField>
				<reportElement x="280" y="0" width="80" height="26" uuid="5e2854de-f727-41ad-9a1a-b4bba0ffb62f">
					<property name="com.jaspersoft.studio.spreadsheet.connectionID" value="b8793c8f-1f79-4362-9067-f863fa206891"/>
				</reportElement>
				<box leftPadding="1" rightPadding="1">
					<pen lineWidth="0.5"/>
					<topPen lineWidth="1.0" lineStyle="Solid" lineColor="#000000"/>
					<leftPen lineWidth="1.0" lineStyle="Solid" lineColor="#000000"/>
					<bottomPen lineWidth="1.0" lineStyle="Solid" lineColor="#000000"/>
					<rightPen lineWidth="1.0" lineStyle="Solid" lineColor="#000000"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle"/>
				<textFieldExpression><![CDATA[$F{price}]]></textFieldExpression>
			</textField>
			<textField>
				<reportElement x="360" y="0" width="79" height="26" uuid="c6cbf3a8-df1e-459b-8189-322bfab5963e">
					<property name="com.jaspersoft.studio.spreadsheet.connectionID" value="b8793c8f-1f79-4362-9067-f863fa206891"/>
				</reportElement>
				<box leftPadding="1" rightPadding="1">
					<pen lineWidth="0.5"/>
					<topPen lineWidth="1.0" lineStyle="Solid" lineColor="#000000"/>
					<leftPen lineWidth="1.0" lineStyle="Solid" lineColor="#000000"/>
					<bottomPen lineWidth="1.0" lineStyle="Solid" lineColor="#000000"/>
					<rightPen lineWidth="1.0" lineStyle="Solid" lineColor="#000000"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle"/>
				<textFieldExpression><![CDATA[$F{company_rate}]]></textFieldExpression>
			</textField>
		</band>
	</detail>
	<pageFooter>
		<band height="55" splitType="Stretch">
			<textField>
				<reportElement x="370" y="25" width="100" height="30" uuid="c17adcb3-ba46-4034-916e-c41eb0815a2b"/>
				<textElement textAlignment="Right"/>
				<textFieldExpression><![CDATA["Page " + $V{PAGE_NUMBER}]]></textFieldExpression>
			</textField>
			<textField evaluationTime="Report">
				<reportElement x="470" y="25" width="100" height="30" uuid="a34d0e31-6ea1-434b-9218-5baae0cd9d98"/>
				<textElement textAlignment="Left"/>
				<textFieldExpression><![CDATA[" of " + $V{PAGE_NUMBER}]]></textFieldExpression>
			</textField>
		</band>
	</pageFooter>
	<summary>
		<band height="55" splitType="Stretch">
			<staticText>
				<reportElement x="0" y="0" width="440" height="30" uuid="241c8570-45c6-4f64-957f-b120cb7e34a1"/>
				<box>
					<topPen lineWidth="1.0" lineStyle="Solid" lineColor="#000000"/>
					<leftPen lineWidth="1.0" lineStyle="Solid" lineColor="#000000"/>
					<bottomPen lineWidth="1.0" lineStyle="Solid" lineColor="#000000"/>
					<rightPen lineWidth="1.0" lineStyle="Solid" lineColor="#000000"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font isBold="true"/>
				</textElement>
				<text><![CDATA[Total Company_Costing]]></text>
			</staticText>
			<textField>
				<reportElement x="440" y="0" width="121" height="30" uuid="cc273865-5036-4d0f-99be-fd87961d42e5"/>
				<box>
					<topPen lineWidth="1.0" lineStyle="Solid" lineColor="#000000"/>
					<leftPen lineWidth="1.0" lineStyle="Solid" lineColor="#000000"/>
					<bottomPen lineWidth="1.0" lineStyle="Solid" lineColor="#000000"/>
					<rightPen lineWidth="1.0" lineStyle="Solid" lineColor="#000000"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle"/>
				<textFieldExpression><![CDATA[$F{total_amount}]]></textFieldExpression>
			</textField>
		</band>
	</summary>
</jasperReport>
